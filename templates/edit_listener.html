{% extends "layout.html" %}
{% block content %}

      <div class="row">
        <br/>
        <div class="col s12 l8 offset-l2">
          <form method="post" action="/edit_listener/{{ g.l.id }}" id="server_form">
            <div class="card">
              <div class="card-content">
                <span class="card-title left pad">Edit NMEA Listener</span>
                <div class="right pad-10"></div>
                <button type="submit" class="right btn-floating btn-large waves-effect waves-light teal"><i class="material-icons" style="font-size: 42px">check</i></button>
                <div class="right pad-10"></div>
                <a href="/" class="btn-pad right btn-floating waves-effect waves-light blue-grey"><i class="material-icons" style="font-size: 28px">close</i></a>
                <a onclick="kill('{{ g.l.id }}')" class="btn-pad right btn-floating waves-effect waves-light red darken-4"><i class="material-icons" style="font-size: 28px">delete</i></a>
              </div>
              <div class="card-content">
                <table class="table highlight pad">
                  <thead>
                    <tr>
                      <th>Name</th>
                      <th>IP</th>
                      <th>Port</th>
                      {% for s in g.servers %}
                        <th>{{ s.name }}</th>
                      {% endfor %}
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td>
                        <div class="input-field">
                          <input name="id" value="{{g.l.id}}" type="hidden"/>
                          <input name="name" value="{{g.l.name}}" type="text"/>
                        </div>
                      </td>
                      <td>
                        <div class="input-field" style="width:120px;">
                          <p class="large-text grey-text text-darken-2">{{g.l.listen_address[0]}}</p>
                        </div>
                      </td>
                      <td>
                        <div class="input-field" style="max-width:72px;">
                          <p class="large-text grey-text text-darken-2">{{g.l.listen_address[1]}}</p>
                        </div>
                      </td>
                      {% for s in g.servers %}
                        <td>
                          <div class="switch">
                            <label>
                              {% if s in g.l.servers %}
                                <input type="checkbox" checked=true name="server_{{s.iface}}">
                              {% else %}
                                <input type="checkbox" name="server_{{s.iface}}">
                              {% endif %}
                              <span class="lever"></span>
                            </label>
                          </div>
                        </td>
                      {% endfor %}
                    </tr>
                  </tbody>
                </table>

              </div>
            </div>
          </form>
        </div>
      </div>

{% endblock %}

{% block body_end %}
  
  
  <script>
    function kill(id) {
      $.post("/kill_listener",{id:id},function(data){
        console.log(data)
        if (data == "ack") {
          window.location = "/";
        }
      })
    }
  
  </script>

  {{ g.error | safe }}

{% endblock %}

